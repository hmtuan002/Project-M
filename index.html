<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiếp Bước - M</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: #1c1e21;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar styles */
        .sidebar {
            width: 360px;
            background-color: #fff;
            border-right: 1px solid #e4e6eb;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e4e6eb;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: #1877f2;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e4e6eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1877f2;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .search-container {
            padding: 10px 16px;
            border-bottom: 1px solid #e4e6eb;
        }

        .search-box {
            background-color: #f0f2f5;
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box input {
            border: none;
            background: transparent;
            width: 100%;
            outline: none;
            font-size: 14px;
        }

        .conversation-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .conversation-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .conversation-item:hover {
            background-color: #f0f2f5;
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .conversation-preview {
            font-size: 13px;
            color: #65676b;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-time {
            font-size: 12px;
            color: #65676b;
        }

        .sidebar-footer {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #e4e6eb;
        }

        .footer-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .footer-icon:hover {
            background-color: #f0f2f5;
        }

        .footer-icon i {
            font-size: 20px;
            color: #65676b;
            margin-bottom: 4px;
        }

        .footer-icon span {
            font-size: 12px;
            color: #65676b;
        }

        /* Chat area styles */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #f0f2f5;
        }

        .chat-header {
            padding: 12px 20px;
            background-color: #fff;
            border-bottom: 1px solid #e4e6eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-actions {
            display: flex;
            gap: 16px;
        }

        .chat-actions i {
            font-size: 20px;
            color: #65676b;
            cursor: pointer;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 65%;
            padding: 10px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        .message-sent {
            align-self: flex-end;
            background-color: #1877f2;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-received {
            align-self: flex-start;
            background-color: #fff;
            color: #1c1e21;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .message-sender {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1877f2;
        }

        .message-time {
            font-size: 11px;
            text-align: right;
            margin-top: 4px;
            opacity: 0.8;
        }

        .image-message {
            max-width: 100%;
            border-radius: 12px;
            margin-top: 5px;
        }

        .input-area {
            padding: 16px 20px;
            background-color: #fff;
            border-top: 1px solid #e4e6eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-area i {
            font-size: 22px;
            color: #65676b;
            cursor: pointer;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 20px;
            border: none;
            background-color: #f0f2f5;
            outline: none;
            font-size: 15px;
        }

        .send-button {
            background-color: #1877f2;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Auth modal styles */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 430px;
            padding: 20px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .auth-tabs {
            display: flex;
            border-bottom: 1px solid #dddfe2;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #65676b;
        }

        .auth-tab.active {
            color: #1877f2;
            border-bottom: 2px solid #1877f2;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 14px;
            font-weight: 600;
            color: #1c1e21;
        }

        .form-group input {
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #dddfe2;
            font-size: 16px;
        }

        .auth-button {
            background-color: #1877f2;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .auth-button:hover {
            background-color: #166fe5;
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dddfe2;
            font-size: 14px;
        }

        .auth-footer a {
            color: #1877f2;
            text-decoration: none;
            font-weight: 600;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e4e6eb;
            }
            
            .conversation-list {
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-container">
            <div class="auth-header">
                <div class="logo">
                    <i class="fa-solid fa-message" style="font-size: 32px; color: #1877f2;"></i>
                    <div class="logo-text">Tiếp Bước - M</div>
                </div>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" id="loginTab">Đăng nhập</div>
                <div class="auth-tab" id="registerTab">Đăng ký</div>
            </div>
            
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Nhập email của bạn" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Mật khẩu</label>
                    <input type="password" id="loginPassword" placeholder="Nhập mật khẩu của bạn" required>
                </div>
                
                <button type="submit" class="auth-button">Đăng nhập</button>
            </form>
            
            <form class="auth-form" id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerName">Họ và tên</label>
                    <input type="text" id="registerName" placeholder="Nhập họ tên của bạn" required>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="Nhập email của bạn" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Mật khẩu</label>
                    <input type="password" id="registerPassword" placeholder="Tạo mật khẩu mới" required>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Xác nhận mật khẩu</label>
                    <input type="password" id="confirmPassword" placeholder="Xác nhận mật khẩu" required>
                </div>
                
                <button type="submit" class="auth-button">Đăng ký</button>
            </form>
            
            <div class="auth-footer">
                <p>Bằng việc đăng ký, bạn đồng ý với <a href="#">Điều khoản</a> và <a href="#">Chính sách quyền riêng tư</a> của chúng tôi.</p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="container" style="display: none;" id="appContainer">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fa-solid fa-message" style="font-size: 28px; color: #1877f2;"></i>
                    <div class="logo-text">Tiếp Bước - M</div>
                </div>
                
                <div class="user-info" id="userInfo">
                    <div class="avatar">
                        <i class="fa-solid fa-user"></i>
                    </div>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" placeholder="Tìm kiếm trên Tiếp Bước - M">
                </div>
            </div>
            
            <div class="conversation-list" id="conversationList">
                <!-- Conversations will be loaded here -->
                <div class="conversation-item">
                    <div class="avatar">
                        <i class="fa-solid fa-user-group"></i>
                    </div>
                    <div class="conversation-info">
                        <div class="conversation-name">Nhóm Học Tập</div>
                        <div class="conversation-preview">Mai thi môn nào nhỉ?</div>
                    </div>
                    <div class="conversation-time">14:30</div>
                </div>
                
                <div class="conversation-item">
                    <div class="avatar">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div class="conversation-info">
                        <div class="conversation-name">Nguyễn Văn A</div>
                        <div class="conversation-preview">Bạn đã xem tài liệu tôi gửi chưa?</div>
                    </div>
                    <div class="conversation-time">12:45</div>
                </div>
                
                <div class="conversation-item">
                    <div class="avatar">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div class="conversation-info">
                        <div class="conversation-name">Trần Thị B</div>
                        <div class="conversation-preview">Cảm ơn bạn đã giúp đỡ!</div>
                    </div>
                    <div class="conversation-time">Hôm qua</div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="footer-icon">
                    <i class="fa-solid fa-user-plus"></i>
                    <span>Bạn bè</span>
                </div>
                <div class="footer-icon">
                    <i class="fa-solid fa-users"></i>
                    <span>Nhóm</span>
                </div>
                <div class="footer-icon">
                    <i class="fa-solid fa-calendar-days"></i>
                    <span>Sự kiện</span>
                </div>
                <div class="footer-icon">
                    <i class="fa-solid fa-ellipsis"></i>
                    <span>Thêm</span>
                </div>
            </div>
        </div>
        
        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-user">
                    <div class="avatar">
                        <i class="fa-solid fa-user-group"></i>
                    </div>
                    <div>
                        <div>Nhóm Học Tập</div>
                        <div style="font-size: 13px; color: #65676b;">Hoạt động 14 phút trước</div>
                    </div>
                </div>
                
                <div class="chat-actions">
                    <i class="fa-solid fa-phone"></i>
                    <i class="fa-solid fa-video"></i>
                    <i class="fa-solid fa-circle-info"></i>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be loaded here -->
                <div class="message message-received">
                    <div class="message-sender">Nguyễn Văn A</div>
                    <div>Chào mọi người, mai chúng ta có lịch học nhóm đúng không?</div>
                    <div class="message-time">14:20</div>
                </div>
                
                <div class="message message-received">
                    <div class="message-sender">Trần Thị B</div>
                    <div>Đúng rồi, 9h sáng tại thư viện nhé</div>
                    <div class="message-time">14:22</div>
                </div>
                
                <div class="message message-sent">
                    <div>Tôi sẽ mang tài liệu ôn tập cho mọi người</div>
                    <div class="message-time">14:25</div>
                </div>
                
                <div class="message message-received">
                    <div class="message-sender">Nguyễn Văn A</div>
                    <div>Cảm ơn bạn! Mọi người nhớ mang theo máy tính nhé</div>
                    <div class="message-time">14:28</div>
                </div>
            </div>
            
            <div class="input-area">
                <i class="fa-solid fa-image" id="imageUpload"></i>
                <i class="fa-solid fa-paperclip"></i>
                <input type="text" class="message-input" placeholder="Nhắn tin" id="messageInput">
                <div class="send-button" id="sendMessage">
                    <i class="fa-solid fa-paper-plane"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase App (initialized in your Firebase console) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase configuration (replace with your own config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const authModal = document.getElementById('authModal');
        const appContainer = document.getElementById('appContainer');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendMessage');
        const messagesContainer = document.getElementById('messagesContainer');
        const imageUpload = document.getElementById('imageUpload');

        // Switch between login and register forms
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.style.display = 'flex';
            registerForm.style.display = 'none';
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.style.display = 'flex';
            loginForm.style.display = 'none';
        });

        // Login function
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    authModal.style.display = 'none';
                    appContainer.style.display = 'flex';
                })
                .catch((error) => {
                    alert("Đăng nhập thất bại: " + error.message);
                });
        });

        // Register function
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert("Mật khẩu xác nhận không khớp!");
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed up
                    const user = userCredential.user;
                    
                    // Save user data to Firestore
                    return db.collection('users').doc(user.uid).set({
                        name: name,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    authModal.style.display = 'none';
                    appContainer.style.display = 'flex';
                })
                .catch((error) => {
                    alert("Đăng ký thất bại: " + error.message);
                });
        });

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                authModal.style.display = 'none';
                appContainer.style.display = 'flex';
                
                // Load user data
                db.collection('users').doc(user.uid).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const userData = doc.data();
                            document.getElementById('userInfo').querySelector('.avatar').innerHTML = 
                                `<i class="fa-solid fa-user"></i>`;
                            // You can display user name here if needed
                        }
                    });
                
                // Load conversations and messages
                loadConversations();
                loadMessages();
            } else {
                authModal.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        });

        // Send message function
        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText === '') return;
            
            const user = auth.currentUser;
            if (user) {
                db.collection('messages').add({
                    text: messageText,
                    sender: user.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    type: 'text'
                })
                .then(() => {
                    messageInput.value = '';
                })
                .catch((error) => {
                    console.error("Lỗi gửi tin nhắn: ", error);
                });
            }
        }

        // Send message on button click or Enter key
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Image upload function
        imageUpload.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    resizeImage(file);
                }
            };
            
            input.click();
        });

        // Function to resize image and convert to base64
        function resizeImage(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    // Calculate new dimensions while maintaining aspect ratio
                    if (width > height) {
                        if (width > 750) {
                            height = Math.round((height * 750) / width);
                            width = 750;
                        }
                    } else {
                        if (height > 750) {
                            width = Math.round((width * 750) / height);
                            height = 750;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to base64
                    const base64String = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Send image message
                    const user = auth.currentUser;
                    if (user) {
                        db.collection('messages').add({
                            image: base64String,
                            sender: user.uid,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            type: 'image'
                        })
                        .catch((error) => {
                            console.error("Lỗi gửi ảnh: ", error);
                        });
                    }
                };
            };
        }

        // Load conversations from Firestore
        function loadConversations() {
            // Implementation for loading conversations
            // This would involve querying Firestore for the user's conversations
        }

        // Load messages from Firestore
        function loadMessages() {
            // Implementation for loading messages
            // This would involve querying Firestore for messages in the current conversation
        }

        // Simulate loading for demonstration purposes
        setTimeout(() => {
            document.querySelector('.auth-modal').style.display = 'flex';
        }, 1000);
    </script>
</body>
</html>
